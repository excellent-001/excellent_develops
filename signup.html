<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Create Account</title>
<style>
  body{font-family:Arial, sans-serif;background:linear-gradient(135deg,#0066cc,#003366);color:#fff;
       min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
  .card{width:min(380px,92vw);background:rgba(255,255,255,.08);border:1px solid #ffffff22;border-radius:16px;
        padding:22px;text-align:center;box-shadow:0 10px 28px rgba(0,0,0,.35);backdrop-filter:blur(6px)}
  h2{margin:6px 0}
  .row{margin:8px 0}
  input{width:100%;padding:12px;border:0;border-radius:10px;background:rgba(255,255,255,.2);color:#fff}
  button.primary{width:100%;padding:12px;border:0;border-radius:10px;cursor:pointer;background:#3399ff;color:#fff;font-weight:700;margin-top:8px}
  .links{margin-top:10px;font-size:12px}
  .links a{color:#eee;text-decoration:none}
  .links a:hover{text-decoration:underline}
  footer{position:fixed;left:0;right:0;bottom:0;background:#fff;color:#000;text-align:center;font-size:13px;padding:8px 10px;border-top:1px solid rgba(0,0,0,.08)}
</style>
</head>
<body>
  <div class="card">
    <img class="logo" src="https://raw.githubusercontent.com/excellent-001/excellent_develops/refs/heads/main/logo.png" alt="Logo" style="width:90px;height:90px;border-radius:50%;object-fit:cover;margin-bottom:8px">
    <h2>Create Account</h2>
    <div class="row"><input id="name" placeholder="Full name" autocomplete="name"></div>
    <div class="row"><input id="email" type="email" placeholder="Email address" autocomplete="email"></div>
    <div class="row"><input id="password" type="password" placeholder="Password" autocomplete="new-password"></div>
    <button class="primary" id="signupBtn">Sign Up</button>
    <div class="links"><a href="index.html">Already have an account? Login</a></div>
  </div>

  <footer>¬© 2025 Excellent, Global, Conceptional. All rights reserved.</footer>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script> emailjs.init({ publicKey:"h5LWzY8YUESb4sZbS" }); </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp, query, where, getDocs, collection } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDoTlLIlOyoYiTZLQmzVcDro-cw9TCU9qI",
      authDomain: "excellent-d056e.firebaseapp.com",
      projectId: "excellent-d056e",
      storageBucket: "excellent-d056e.firebasestorage.app",
      messagingSenderId: "629984941607",
      appId: "1:629984941607:web:3d7fc2478f555d45a0e002",
      measurementId: "G-G3RCTDSY27"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    async function getGeo(){
      try{ const r=await fetch("https://ipapi.co/json/"); const j=await r.json(); return { ip:j.ip, isp:j.org||"Unknown ISP", city:j.city||"Unknown City" }; }
      catch{ return { ip:"", isp:"", city:"" }; }
    }

    document.getElementById('signupBtn').onclick = async ()=>{
      const name = (document.getElementById('name').value||"").trim();
      const email = (document.getElementById('email').value||"").trim();
      const pass = document.getElementById('password').value;
      if(!name || !email || !pass){ alert("Please fill in all fields."); return; }

      try{
        const {ip, isp, city} = await getGeo();
        const ispCity = `${isp}_${city}`;

        // Blocked list check
        const q1 = query(collection(db,"blockedUsers"), where("ip","==",ip));
        const q2 = query(collection(db,"blockedUsers"), where("ispCity","==",ispCity));
        const s1 = await getDocs(q1); const s2 = await getDocs(q2);
        if(!s1.empty || !s2.empty){
          await emailjs.send("service_cvvr3vn","template_6xgms6a",{
            from_name:"Excellent_Develops Security",to_name:"Admin",to_email:"quareebalabi22@gmail.com",
            message:`üö´ BLOCKED SIGNUP ATTEMPT\n\nName: ${name}\nEmail: ${email}\nIP: ${ip}\nISP: ${isp}\nCity: ${city}`
          });
          alert("üö´ You are blocked from creating an account.");
          return;
        }

        // Throttle: max 2 signups per IP / ispCity
        const ipQ = query(collection(db,"users"), where("ip","==",ip));
        const icQ = query(collection(db,"users"), where("ispCity","==",ispCity));
        const ipS = await getDocs(ipQ); const icS = await getDocs(icQ);
        if(ipS.size >= 2 || icS.size >= 2){ alert("‚ùå Signup limit reached for this network/location."); return; }

        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        await updateProfile(cred.user, { displayName: name });

        await setDoc(doc(db,"users", cred.user.uid), {
          name, email, ip, isp, city, ispCity, createdAt: serverTimestamp()
        });

        await emailjs.send("service_cvvr3vn","template_6xgms6a",{
          from_name:"Excellent_Develops System",to_name:"Admin",to_email:"quareebalabi22@gmail.com",
          message:`üìã New User Signup\nName: ${name}\nEmail: ${email}\nIP: ${ip}\nISP: ${isp}\nCity: ${city}`
        });

        location.href = "index.html?msg=Account%20created%20successfully%20%E2%9C%85";
      }catch(e){ alert("‚ùå " + (e?.message||e)); }
    };
  </script>
</body>
</html>
