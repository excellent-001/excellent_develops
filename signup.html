<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Create Account • Excellent_Develops</title>
<style>
  :root{ --g1:#4b0082; --g2:#800080; --accent:#8a2be2; --glass:rgba(255,255,255,.06);}
  *{box-sizing:border-box}
  body{
    margin:0;font-family:system-ui,Segoe UI,Arial;min-height:100vh;color:#fff;
    background: radial-gradient(1000px 900px at 80% 10%, rgba(255,255,255,.12) 0%, transparent 60%),
                linear-gradient(135deg,var(--g1),var(--g2));
    display:flex;align-items:center;justify-content:center;padding:24px;
  }
  .card{
    width:min(420px,94vw);background:var(--glass);border:1px solid rgba(255,255,255,.15);
    border-radius:16px;padding:22px;box-shadow:0 12px 36px rgba(0,0,0,.28);animation:pop .45s ease-out both
  }
  @keyframes pop{0%{transform:scale(.96);opacity:0}100%{transform:scale(1);opacity:1}}
  h2{margin:6px 0 8px}
  .row{display:flex;gap:10px}
  label{font-size:12px;opacity:.95;margin:8px 0 4px;display:block}
  input{
    width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.25);
    background:rgba(255,255,255,.12);color:#fff;outline:none;
  }
  .pw{position:relative}
  .toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:transparent;border:0;color:#fff;cursor:pointer;font-size:12px}
  .btn{width:100%;padding:12px 14px;border:0;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;margin-top:12px;cursor:pointer}
  .note{font-size:12px;opacity:.9;margin-top:8px}
  a{color:#fff}
</style>
</head>
<body>
  <div class="card">
    <h2>Create Account</h2>
    <div class="row">
      <div style="flex:1">
        <label>First Name</label>
        <input id="firstName" type="text" placeholder="First name"/>
      </div>
      <div style="flex:1">
        <label>Last Name</label>
        <input id="lastName" type="text" placeholder="Last name"/>
      </div>
    </div>
    <label>Username</label>
    <input id="username" type="text" placeholder="Choose a username"/>
    <label>Email</label>
    <input id="email" type="email" placeholder="you@example.com"/>
    <div class="row">
      <div class="pw" style="flex:1">
        <label>Password</label>
        <input id="password" type="password" placeholder="••••••••"/>
        <button class="toggle" type="button" data-target="password">Show</button>
      </div>
      <div class="pw" style="flex:1">
        <label>Confirm Password</label>
        <input id="confirm" type="password" placeholder="••••••••"/>
        <button class="toggle" type="button" data-target="confirm">Show</button>
      </div>
    </div>
    <button class="btn" id="createBtn">Create Account</button>
    <div class="note">Already have an account? <a href="login.html">Back to Login</a></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, updateProfile, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDoTlLIlOyoYiTZLQmzVcDro-cw9TCU9qI",
      authDomain: "excellent-d056e.firebaseapp.com",
      projectId: "excellent-d056e",
      storageBucket: "excellent-d056e.firebasestorage.app",
      messagingSenderId: "629984941607",
      appId: "1:629984941607:web:3d7fc2478f555d45a0e002",
      measurementId: "G-G3RCTDSY27"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    document.querySelectorAll('.toggle').forEach(b=>{
      b.onclick = ()=>{
        const id = b.getAttribute('data-target');
        const el = document.getElementById(id);
        el.type = el.type === 'password' ? 'text' : 'password';
        b.textContent = el.type === 'password' ? 'Show' : 'Hide';
      };
    });

    async function usernameAvailable(un){
      const snap = await getDoc(doc(db,"usernames",un.toLowerCase()));
      return !snap.exists();
    }

    document.getElementById('createBtn').onclick = async ()=>{
      const first = document.getElementById('firstName').value.trim();
      const last  = document.getElementById('lastName').value.trim();
      const un    = document.getElementById('username').value.trim();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const pw    = document.getElementById('password').value;
      const cpw   = document.getElementById('confirm').value;
      if(!first || !last || !un || !email || !pw){ alert("Fill all fields."); return; }
      if(pw !== cpw){ alert("Passwords do not match."); return; }
      if(!(await usernameAvailable(un))){ alert("Username already taken."); return; }

      try{
        const cred = await createUserWithEmailAndPassword(auth,email,pw);
        await updateProfile(cred.user,{ displayName: `${first} ${last}` });
        await setDoc(doc(db,"usernames",un.toLowerCase()),{ email, uid: cred.user.uid, username: un, first, last });
        await signOut(auth); // don’t bypass login
        alert("Account created. Please login.");
        window.location.href = "login.html";
      }catch(e){ alert(e.message); }
    };
  </script>
</body>
</html>
