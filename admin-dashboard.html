<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Dashboard â€” Excellent_Develops</title>
<style>
  :root{--bg1:#0b1220;--bg2:#0f172a;--card:#101726;--ink:#e5e7eb;--muted:#9ca3af;--accent:#3b82f6;}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--ink);min-height:100vh;display:flex;flex-direction:column}
  header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:rgba(0,0,0,.25);border-bottom:1px solid #00000040}
  main{padding:18px;max-width:1200px;margin:0 auto;width:100%}
  .btn{border:1px solid #ffffff22;background:#0b1324;color:var(--ink);padding:9px 12px;border-radius:10px;cursor:pointer}
  .btn.primary{background:var(--accent);border-color:transparent}
  .chip{padding:4px 10px;border-radius:999px;background:#ffffff12;border:1px solid #ffffff22;font-size:12px}
  .notice{background:#1f2937;border:1px solid #2b3a55;border-radius:12px;padding:14px;margin:14px 0}
</style>

<!-- GUARD: runs before anything is shown -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  const ADMIN_EMAILS = ["quareebalabi22@gmail.com"];
  const SECRET_CODE  = "554455";
  const firebaseConfig = {
    apiKey: "AIzaSyDoTlLIlOyoYiTZLQmzVcDro-cw9TCU9qI",
    authDomain: "excellent-d056e.firebaseapp.com",
    projectId: "excellent-d056e",
    storageBucket: "excellent-d056e.firebasestorage.app",
    messagingSenderId: "629984941607",
    appId: "1:629984941607:web:3d7fc2478f555d45a0e002",
    measurementId: "G-G3RCTDSY27"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const qs = new URLSearchParams(location.search);
  const hasSecret = (qs.get("code")||"") === SECRET_CODE;

  // helper: hard redirect out
  function bounce(){
    try{ signOut(auth); }catch{}
    location.replace("index.html");
  }

  // Check session token
  function validGate(){
    try{
      const raw = sessionStorage.getItem("adminGate");
      if(!raw) return false;
      const obj = JSON.parse(raw);
      if(!obj?.ok || !obj?.t) return false;
      // expire after 2 hours
      const TWO_HOURS = 2*60*60*1000;
      if (Date.now() - obj.t > TWO_HOURS) return false;
      return true;
    }catch{return false;}
  }

  onAuthStateChanged(auth, (user)=>{
    const email = (user?.email||"").toLowerCase();
    const allowed = !!user && ADMIN_EMAILS.includes(email);
    if (!allowed || !hasSecret || !validGate()){
      bounce();
      return;
    }
    // pass email to UI
    const el = document.getElementById("adminEmail");
    if (el) el.textContent = email;
    document.documentElement.style.visibility = "visible";
  });

  // Hide entire page until guard passes
  document.documentElement.style.visibility = "hidden";
</script>
</head>
<body>
  <header>
    <div>
      <strong>Admin Dashboard</strong>
      <span class="chip">Excellent_Develops</span>
    </div>
    <div>
      <span id="adminEmail" class="chip"></span>
      <button class="btn" onclick="location.href='index.html'">Sign out</button>
    </div>
  </header>

  <main>
    <div class="notice">
      <strong>Secure Admin Gate is active.</strong><br/>
      This page is only visible with: correct URL code, valid admin email, and an active admin gate token.
    </div>

    <!-- YOUR EXISTING ADMIN UI BELOW -->
    <!-- If you already have a big admin page, keep it.
         The guard above protects it. You can paste your whole admin HTML here. -->
    <p>Load your full dashboard UI here (feedback, visitors, users, settings, etc.).</p>
  </main>
</body>
  </html>
