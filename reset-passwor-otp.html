<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Reset Password</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
</head>
<body>
  <h2>Reset Your Password</h2>
  
  <div>
    <input type="email" id="email" placeholder="Enter your email">
    <button id="sendCode">Send Verification Code</button>
  </div>

  <div style="margin-top:15px;">
    <input type="text" id="verificationCode" placeholder="Enter code">
    <button id="verifyCode">Verify Code</button>
  </div>

  <div style="margin-top:15px;">
    <input type="password" id="newPassword" placeholder="Enter new password">
    <button id="resetPassword">Reset Password</button>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDoTlLIlOyoYiTZLQmzVcDro-cw9TCU9qI",
      authDomain: "excellent-d056e.firebaseapp.com",
      projectId: "excellent-d056e",
      storageBucket: "excellent-d056e.firebasestorage.app",
      messagingSenderId: "629984941607",
      appId: "1:629984941607:web:3d7fc2478f555d45a0e002",
      measurementId: "G-G3RCTDSY27"
    };
    firebase.initializeApp(firebaseConfig);

    // EmailJS init
    (function(){
      emailjs.init("h5LWzY8YUESb4sZbS");
    })();

    let generatedCode = "";
    let emailForReset = "";

    document.getElementById('sendCode').addEventListener('click', function() {
      emailForReset = document.getElementById('email').value.trim();
      if(!emailForReset) {
        alert("Please enter your email");
        return;
      }
      generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
      emailjs.send("service_cvvr3vn", "template_6xgms6a", {
        to_email: emailForReset,
        verification_code: generatedCode
      }).then(function() {
        alert("Verification code sent to your email.");
      }, function(err) {
        alert("Error sending code: " + JSON.stringify(err));
      });
    });

    document.getElementById('verifyCode').addEventListener('click', function() {
      const enteredCode = document.getElementById('verificationCode').value.trim();
      if(enteredCode === generatedCode) {
        alert("Code verified. You can now reset your password.");
      } else {
        alert("Incorrect code. Please try again.");
      }
    });

    document.getElementById('resetPassword').addEventListener('click', function() {
      const enteredCode = document.getElementById('verificationCode').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();

      if(enteredCode !== generatedCode) {
        alert("You must enter the correct verification code first.");
        return;
      }
      if(newPassword.length < 6) {
        alert("Password must be at least 6 characters.");
        return;
      }

      firebase.auth().sendPasswordResetEmail(emailForReset)
        .then(() => {
          alert("Password reset email sent. Redirecting to login...");
          window.location.href = "login.html";
        })
        .catch((error) => {
          alert("Error: " + error.message);
        });
    });
  </script>
</body>
</html>
